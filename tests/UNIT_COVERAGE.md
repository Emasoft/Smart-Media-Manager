# Unit Test Coverage

- [X] `build_safe_stem` - smart_media_manager/cli.py
- [X] `brew_package_installed` - smart_media_manager/cli.py
- [X] `canonical_image_extension` - smart_media_manager/cli.py
- [X] `canonical_video_extension` - smart_media_manager/cli.py
- [X] `canonicalize_extension` - smart_media_manager/cli.py
- [X] `choose_vote_by_priority` - smart_media_manager/cli.py
- [X] `cleanup_staging` - smart_media_manager/cli.py
- [X] `collect_raw_groups_from_extensions` - smart_media_manager/cli.py
- [X] `copy_metadata_from_source` - smart_media_manager/cli.py
- [X] `ensure_brew_package` - smart_media_manager/cli.py
- [X] `ensure_compatibility` - smart_media_manager/cli.py
- [X] `ensure_dot_extension` - smart_media_manager/cli.py
- [X] `ensure_ffmpeg_path` - smart_media_manager/cli.py
- [X] `ensure_homebrew` - smart_media_manager/cli.py
- [X] `ensure_system_dependencies` - smart_media_manager/cli.py
- [X] `extension_from_description` - smart_media_manager/cli.py
- [X] `extension_from_mime` - smart_media_manager/cli.py
- [X] `extract_container` - smart_media_manager/cli.py
- [X] `find_executable` - smart_media_manager/cli.py
- [X] `gather_media_files` - smart_media_manager/cli.py
- [X] `get_psd_color_mode` - smart_media_manager/cli.py
- [X] `guess_extension` - smart_media_manager/cli.py
- [X] `import_folder_to_photos` - smart_media_manager/cli.py
- [X] `install_raw_dependency_groups` - smart_media_manager/cli.py
- [X] `is_animated_gif` - smart_media_manager/cli.py
- [X] `is_animated_png` - smart_media_manager/cli.py
- [X] `is_animated_webp` - smart_media_manager/cli.py
- [X] `is_archive_signature` - smart_media_manager/cli.py
- [X] `is_image_signature` - smart_media_manager/cli.py
- [X] `is_panoramic_photo` - smart_media_manager/cli.py
- [X] `is_raw_extension` - smart_media_manager/cli.py
- [X] `is_skippable_file` - smart_media_manager/cli.py
- [X] `is_supported_video_codec` - smart_media_manager/cli.py
- [X] `is_textual_mime` - smart_media_manager/cli.py
- [X] `is_video_signature` - smart_media_manager/cli.py
- [X] `kind_from_description` - smart_media_manager/cli.py
- [X] `kind_from_extension` - smart_media_manager/cli.py
- [X] `kind_from_mime` - smart_media_manager/cli.py
- [X] `looks_like_text_file` - smart_media_manager/cli.py
- [X] `main` - smart_media_manager/cli.py
- [X] `move_to_staging` - smart_media_manager/cli.py
- [X] `next_available_name` - smart_media_manager/cli.py
- [X] `normalize_extension` - smart_media_manager/cli.py
- [X] `normalize_mime_value` - smart_media_manager/cli.py
- [X] `parse_args` - smart_media_manager/cli.py
- [X] `resolve_imagemagick_command` - smart_media_manager/cli.py
- [X] `resolve_restore_path` - smart_media_manager/cli.py
- [X] `restore_media_file` - smart_media_manager/cli.py
- [X] `run` - smart_media_manager/cli.py
- [X] `sanitize_path_string` - smart_media_manager/cli.py
- [X] `should_ignore` - smart_media_manager/cli.py
- [X] `stem_needs_sanitization` - smart_media_manager/cli.py
- [X] `timestamp` - smart_media_manager/cli.py
- [X] `tool_rank` - smart_media_manager/cli.py
- [X] `vote_weight` - smart_media_manager/cli.py
- [X] `votes_error_summary` - smart_media_manager/cli.py
- [X] `attach_file_logger` - smart_media_manager/cli.py
- [X] `brew_cask_installed` - smart_media_manager/cli.py
- [X] `check_write_permission` - smart_media_manager/cli.py
- [X] `choose_image_extension` - smart_media_manager/cli.py
- [X] `choose_video_extension` - smart_media_manager/cli.py
- [X] `classify_with_binwalk` - smart_media_manager/cli.py
- [X] `classify_with_libmagic` - smart_media_manager/cli.py
- [X] `classify_with_puremagic` - smart_media_manager/cli.py
- [X] `classify_with_pyfsig` - smart_media_manager/cli.py
- [X] `collect_format_votes` - smart_media_manager/cli.py
- [X] `configure_logging` - smart_media_manager/cli.py
- [X] `convert_animation_to_hevc_mp4` - smart_media_manager/cli.py
- [X] `convert_image` - smart_media_manager/cli.py
- [X] `convert_to_heic_lossless` - smart_media_manager/cli.py
- [X] `convert_to_png` - smart_media_manager/cli.py
- [X] `convert_to_tiff` - smart_media_manager/cli.py
- [X] `convert_video` - smart_media_manager/cli.py
- [X] `detect_live_photo_pairs` - smart_media_manager/cli.py
- [~] `detect_media` - smart_media_manager/cli.py (integration test only - too complex for unit testing: 409 lines, orchestrates 16+ functions)
- [X] `determine_media_kind` - smart_media_manager/cli.py
- [X] `ensure_brew_cask` - smart_media_manager/cli.py
- [X] `ensure_dependency` - smart_media_manager/cli.py
- [X] `ensure_pip_package` - smart_media_manager/cli.py
- [X] `ensure_raw_dependencies_for_files` - smart_media_manager/cli.py
- [X] `extract_and_normalize_metadata` - smart_media_manager/cli.py
- [X] `extract_live_photo_content_id` - smart_media_manager/cli.py
- [X] `ffprobe` - smart_media_manager/cli.py
- [X] `is_video_corrupt_or_truncated` - smart_media_manager/cli.py
- [X] `pip_package_installed` - smart_media_manager/cli.py
- [X] `prompt_retry_failed_imports` - smart_media_manager/cli.py
- [X] `refine_image_media` - smart_media_manager/cli.py
- [X] `refine_raw_media` - smart_media_manager/cli.py
- [X] `refine_video_media` - smart_media_manager/cli.py
- [X] `revert_media_files` - smart_media_manager/cli.py
- [X] `rewrap_or_transcode_to_mp4` - smart_media_manager/cli.py
- [X] `rewrap_to_mp4` - smart_media_manager/cli.py
- [X] `run_checked` - smart_media_manager/cli.py
- [X] `run_command_with_progress` - smart_media_manager/cli.py
- [X] `safe_filetype_guess` - smart_media_manager/cli.py
- [X] `safe_puremagic_guess` - smart_media_manager/cli.py
- [X] `select_consensus_vote` - smart_media_manager/cli.py
- [X] `skip_unknown_video` - smart_media_manager/cli.py
- [X] `transcode_audio_to_supported` - smart_media_manager/cli.py
- [X] `transcode_to_hevc_mp4` - smart_media_manager/cli.py
- [X] `validate_path_argument` - smart_media_manager/cli.py
- [X] `validate_root` - smart_media_manager/cli.py
